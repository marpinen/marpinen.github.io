<html>
<head>
    <title>Cooper test distance predictor</title>
    <style>
        body {
            text-align: center;
			font-size: 4vw;
        }
        #lap-list {
            list-style-type: decimal;
            padding-left: 20px;
            display: inline-block;
            text-align: left;
        }
		
		#lap-list li span {
			margin-left: 10px;
		}
		button {
			-webkit-appearance: none;
			font-size: 1em;
			padding: 1.2em 1.2em;
			color: #000
		}
		#timer {
			font-size: 2em;
		
		}
		#lap-timer {
			font-size: 1em;
		
		}
		#track-length {
			font-size: 1em;
			width: 12%;
		}
      
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    /* Firefox */
    input[type=number] {
      -moz-appearance: textfield;
    }
    </style>
</head>
<body>
    <label for="track-length">Track length (m): </label>
    <input type="number" id="track-length" value="337"><br><br>

    <div id="timer">12:00</div><br>
    <div id="lap-timer">( 00:00 )</div><br>

    <button id="start-button">Start</button>
    <button id="reset-button" style="display: none;">Reset</button>
    <button id="lap-button">Lap +1</button><br><br>

    <ol id="lap-list"></ol>

    <script>
        let track_length = 337;
        let time = 12 * 60;
        let lap_time = 0;
        let lap_times = [];
        let last_lap_time = time;
        let timer_running = false;

		function startTimer() {
			timer_running = true;
			track_length = document.getElementById("track-length").value; // Update track_length based on user input
			let timer = setInterval(function() {
				time--;
				lap_time++;
				let minutes = Math.floor(time / 60);
				let seconds = time % 60;
				document.getElementById("timer").innerHTML = `${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
				minutes = Math.floor(lap_time / 60);
				seconds = lap_time % 60;
				document.getElementById("lap-timer").innerHTML = `( ${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")} )`;
				if (time === 0) {
					clearInterval(timer);
					timer_running = false;

					// Display the distance of the full laps
					let full_laps_distance = lap_times.length * track_length;
					let full_laps_text = document.createElement("p");
					full_laps_text.innerHTML = `The distance of the full laps: ${full_laps_distance} m.<br>Measure the length of the last lap!`;
					document.body.appendChild(full_laps_text);
				}
			}, 1000);

			let start_button = document.getElementById("start-button");
			start_button.style.display = "none";
			let reset_button = document.getElementById("reset-button");
			reset_button.style.display = "inline-block";
		}


        function addLap() {
            if (!timer_running) return;

            lap_times.push(time);
            let lap_list = document.getElementById("lap-list");
            let lap_time_element = document.createElement("li");
            let lap_duration = last_lap_time - time;
            last_lap_time = time;
            let minutes = Math.floor(lap_duration / 60);
            let seconds = lap_duration % 60;
            lap_time_element.innerHTML = `${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
            lap_list.appendChild(lap_time_element);

            let distance_prediction = document.createElement("span");
            let average_lap_time = (12 * 60 - time) / lap_times.length;
            let predicted_laps = time / average_lap_time;
            let predicted_distance = (predicted_laps + lap_times.length) * track_length;
            distance_prediction.innerHTML = ` Predicted distance: ${Math.round(predicted_distance)} m`;
            lap_time_element.appendChild(distance_prediction);

            // Reset the lap timer
            lap_time = 0;
        }

        function reset() {
            location.reload();
        }
       
        /* fix for preventing double presses on mobile */
        function handleEvent(event) {
            if (event.type === "touchend") {
                event.preventDefault();
            }
            if (event.target.id === "start-button") {
                startTimer();
            } else if (event.target.id === "lap-button") {
                addLap();
            } else if (event.target.id === "reset-button") {
                reset();
            }
        }

        document.addEventListener("click", handleEvent);
        document.addEventListener("touchend", handleEvent);
    
    </script>
</body>

</html>

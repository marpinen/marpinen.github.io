<!DOCTYPE html>
<html>
<head>
    <title>Cooper test distance predictor</title>
    <style>
        body {
            text-align: center;
			font-size: 4vw;
        }
        #lap-list {
            list-style-type: decimal;
            padding-left: 20px;
            display: inline-block;
            text-align: left;
        }
		
		#lap-list li span {
			margin-left: 10px;
		}
		button {
			-webkit-appearance: none;
			font-size: 1em;
			padding: 1.2em 1.2em;
			color: #000
		}
		#timer {
			font-size: 2em;
		}
		#track-length {
			font-size: 1em;
			width: 10%;
		}	
    </style>
</head>
<body>
    <label for="track-length">Track length (m): </label>
    <input type="number" id="track-length" value="337"><br><br>

    <div id="timer">12:00</div><br>

    <button id="start-button">Start</button>
    <button id="lap-button">Lap +1</button><br><br>

    <ol id="lap-list"></ol>

    <script>
        let track_length = 337;
        let time = 1 * 60;
        let lap_times = [];
        let last_lap_time = time;
        let timer_running = false;

		function startTimer() {
			timer_running = true;
			track_length = document.getElementById("track-length").value; // Update track_length based on user input
			let timer = setInterval(function() {
				time--;
				let minutes = Math.floor(time / 60);
				let seconds = time % 60;
				document.getElementById("timer").innerHTML = `${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
				if (time === 0) {
					clearInterval(timer);
					timer_running = false;

					// Display the distance of the full laps
					let full_laps_distance = lap_times.length * track_length;
					let full_laps_text = document.createElement("p");
					full_laps_text.innerHTML = `The distance of the full laps: ${full_laps_distance} m.<br>Measure the length of the last lap!`;
					document.body.appendChild(full_laps_text);
				}
			}, 1000);

			let start_button = document.getElementById("start-button");
			start_button.innerHTML = "Reset";
			start_button.removeEventListener("click", startTimer);
			start_button.addEventListener("click", reset);
			start_button.removeEventListener("touchstart", startTimer);
			start_button.addEventListener("touchstart", reset);
		}


        function addLap() {
            if (!timer_running) return;

            lap_times.push(time);
            let lap_list = document.getElementById("lap-list");
            let lap_time = document.createElement("li");
            let lap_duration = last_lap_time - time;
            last_lap_time = time;
            let minutes = Math.floor(lap_duration / 60);
            let seconds = lap_duration % 60;
            lap_time.innerHTML = `${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
            lap_list.appendChild(lap_time);

            let distance_prediction = document.createElement("span");
            let average_lap_time = (12 * 60 - time) / lap_times.length;
            let predicted_laps = time / average_lap_time;
            let predicted_distance = (predicted_laps + lap_times.length) * track_length;
            distance_prediction.innerHTML = ` Predicted distance: ${Math.round(predicted_distance)} m`;
            lap_time.appendChild(distance_prediction);
        }

        function reset() {
            location.reload();
        }
		
        document.getElementById("start-button").addEventListener("click", startTimer);
		document.getElementById("lap-button").addEventListener("click", addLap); 
		
		document.getElementById("start-button").addEventListener("touchstart", startTimer);		
		document.getElementById("lap-button").addEventListener("touchstart", addLap);
		

    </script>
</body>
</html>

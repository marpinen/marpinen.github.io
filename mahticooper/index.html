<!DOCTYPE html>
<html>
<head>
    <title>Cooper test distance predictor</title>
    <style>
        body {
            text-align: center;
        }
        #lap-list {
            list-style-type: decimal;
            padding-left: 20px;
            display: inline-block;
            text-align: left;
        }
		
		#lap-list li span {
			margin-left: 10px;
		}
		p {
		  font-size: 1.2em;
		}
		
    </style>
</head>
<body>
    <label for="track-length">Track length (m): </label>
    <input type="number" id="track-length" value="337"><br><br>

    <div id="timer">12:00</div><br>

    <button id="start-button">Start</button>
    <button id="lap-button">Lap +1</button><br><br>

    <ol id="lap-list"></ol>

    <script>
        let track_length = 337;
        let time = 12 * 60;
        let lap_times = [];
        let last_lap_time = time;
        let timer_running = false;

        function startTimer() {
            timer_running = true;
            let timer = setInterval(function() {
                time--;
                let minutes = Math.floor(time / 60);
                let seconds = time % 60;
                document.getElementById("timer").innerHTML = `${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
                if (time === 0) {
                    clearInterval(timer);
                    timer_running = false;
                }
            }, 1000);

            let start_button = document.getElementById("start-button");
            start_button.innerHTML = "Reset";
            start_button.removeEventListener("click", startTimer);
            start_button.addEventListener("click", reset);
        }

        function addLap() {
            if (!timer_running) return;

            lap_times.push(time);
            let lap_list = document.getElementById("lap-list");
            let lap_time = document.createElement("li");
            let lap_duration = last_lap_time - time;
            last_lap_time = time;
            let minutes = Math.floor(lap_duration / 60);
            let seconds = lap_duration % 60;
            lap_time.innerHTML = `${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
            lap_list.appendChild(lap_time);

            let distance_prediction = document.createElement("span");
            let average_lap_time = (12 * 60 - time) / lap_times.length;
            let predicted_laps = time / average_lap_time;
            let predicted_distance = (predicted_laps + lap_times.length) * track_length;
            distance_prediction.innerHTML = ` Predicted distance: ${Math.round(predicted_distance)} m`;
            lap_time.appendChild(distance_prediction);
        }

        function reset() {
            location.reload();
        }

        document.getElementById("start-button").addEventListener("click", startTimer);
        document.getElementById("lap-button").addEventListener("click", addLap);
    </script>
</body>
</html>
